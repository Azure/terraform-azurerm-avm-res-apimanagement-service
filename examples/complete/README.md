<!-- BEGIN_TF_DOCS -->
<!-- Code generated by terraform-docs. DO NOT EDIT. -->
# Complete Example

This example demonstrates the core features of the Azure API Management module, including APIs with operations, products, subscriptions, named values, and policies. It provides a comprehensive showcase of API lifecycle management capabilities.

```hcl
terraform {
  required_version = ">= 1.9"

  required_providers {
    azurerm = {
      source  = "hashicorp/azurerm"
      version = ">= 4.0, < 5.0"
    }
  }
}

provider "azurerm" {
  subscription_id = var.subscription_id
  features {}
}

## Section to provide a random Azure region for the resource group
# This allows us to randomize the region for the resource group, or use a specified region.
module "regions" {
  source  = "Azure/regions/azurerm"
  version = ">= 0.3.0"
}

# Use specified region or random one if not provided
locals {
  azure_region = var.azure_region != null ? var.azure_region : module.regions.regions[random_integer.region_index.result].name
}

# This allows us to randomize the region for the resource group.
resource "random_integer" "region_index" {
  max = length(module.regions.regions) - 1
  min = 0
}
## End of section to provide a random Azure region for the resource group

# This ensures we have unique CAF compliant names for our resources.
module "naming" {
  source  = "Azure/naming/azurerm"
  version = ">= 0.3.0"
}

# This is required for resource modules
resource "azurerm_resource_group" "this" {
  location = local.azure_region
  name     = "${var.resource_group_name_prefix}-${module.naming.resource_group.name_unique}"
}

# This is the module call
module "apim" {
  source = "../../"

  location            = azurerm_resource_group.this.location
  name                = module.naming.api_management.name_unique
  publisher_email     = "admin@contoso.com"
  resource_group_name = azurerm_resource_group.this.name
  # =================================================================
  # APIs with Operations Configuration
  # =================================================================
  apis = {
    # Simple Echo API for testing
    "echo-api" = {
      display_name          = "Echo API"
      path                  = "echo"
      protocols             = ["https"]
      revision              = "1"
      description           = "Simple echo API for testing - returns request information"
      subscription_required = true
      service_url           = "http://echoapi.cloudapp.net/api"

      # API-Level Policy - applies to all operations in this API
      policy = {
        xml_content = <<-XML
<policies>
  <inbound>
    <base />
    <rate-limit calls="100" renewal-period="60" />
    <set-header name="X-API-Name" exists-action="override">
      <value>Echo API</value>
    </set-header>
  </inbound>
  <backend>
    <base />
  </backend>
  <outbound>
    <base />
    <set-header name="X-Powered-By" exists-action="delete" />
  </outbound>
  <on-error>
    <base />
  </on-error>
</policies>
XML
      }

      # Single operation to demonstrate API operation creation
      operations = {
        "get-resource" = {
          display_name = "Get Resource"
          method       = "GET"
          url_template = "/resource"
          description  = "Echo back request information"

          responses = [
            {
              status_code = 200
              description = "Success - returns request echo"
              representations = [
                {
                  content_type = "application/json"
                }
              ]
            }
          ]
        }
      }
    }
  }
  enable_telemetry = var.enable_telemetry
  # Enable managed identity (optional - useful for accessing other Azure resources)
  managed_identities = {
    system_assigned = true
  }
  # =================================================================
  # Named Values Configuration
  # Named values are like environment variables - can be referenced in policies
  # =================================================================
  named_values = {
    # Plain text configuration value
    "backend-url" = {
      display_name = "Backend-URL"
      value        = "http://echoapi.cloudapp.net/api"
      tags         = ["configuration", "url"]
    }

    # Secret value (encrypted at rest in APIM)
    "api-key" = {
      display_name = "API-Key"
      value        = "secret-key-value-12345"
      secret       = true
      tags         = ["secret", "api"]
    }

    # Environment indicator
    "environment" = {
      display_name = "Environment"
      value        = "development"
      tags         = ["environment"]
    }
  }
  # =================================================================
  # Products Configuration
  # Products package APIs with policies and access control
  # =================================================================
  products = {
    "starter" = {
      display_name          = "Starter"
      description           = "Basic API access for developers"
      subscription_required = true
      approval_required     = false
      state                 = "published"
      terms                 = "By subscribing to this product, you agree to our terms of service."
      api_names             = ["echo-api"] # Link API to this product
      group_names           = ["developers"]
    }

    "premium" = {
      display_name          = "Premium"
      description           = "Premium access with higher rate limits - requires approval"
      subscription_required = true
      approval_required     = true
      subscriptions_limit   = 10
      state                 = "published"
      api_names             = ["echo-api"] # Same API, different product tier
      group_names           = ["developers", "guests"]
    }
  }
  publisher_name = "Contoso"
  sku_name       = "Developer_1"
  # =================================================================
  # Subscriptions Configuration
  # Subscriptions provide access keys for consuming products/APIs
  # =================================================================
  subscriptions = {
    "starter-subscription" = {
      display_name     = "Starter Subscription"
      scope_type       = "product"
      scope_identifier = "starter"
      state            = "active"
      allow_tracing    = true
    }

    "premium-subscription" = {
      display_name     = "Premium Subscription"
      scope_type       = "product"
      scope_identifier = "premium"
      state            = "submitted" # Awaiting approval (because premium requires approval)
      allow_tracing    = true
    }
  }
}
```

<!-- markdownlint-disable MD033 -->
## Requirements

The following requirements are needed by this module:

- <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) (>= 1.9)

- <a name="requirement_azurerm"></a> [azurerm](#requirement\_azurerm) (>= 4.0, < 5.0)

## Resources

The following resources are used by this module:

- [azurerm_resource_group.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/resource_group) (resource)
- [random_integer.region_index](https://registry.terraform.io/providers/hashicorp/random/latest/docs/resources/integer) (resource)

<!-- markdownlint-disable MD013 -->
## Required Inputs

The following input variables are required:

### <a name="input_subscription_id"></a> [subscription\_id](#input\_subscription\_id)

Description: The Azure subscription ID to deploy resources into.

Type: `string`

## Optional Inputs

The following input variables are optional (have default values):

### <a name="input_azure_region"></a> [azure\_region](#input\_azure\_region)

Description: The Azure region to deploy resources into. If not specified, a random region will be selected from available Azure regions.

Type: `string`

Default: `null`

### <a name="input_enable_telemetry"></a> [enable\_telemetry](#input\_enable\_telemetry)

Description: This variable controls whether or not telemetry is enabled for the module.  
For more information see <https://aka.ms/avm/telemetryinfo>.  
If it is set to false, then no telemetry will be collected.

Type: `bool`

Default: `true`

### <a name="input_resource_group_name_prefix"></a> [resource\_group\_name\_prefix](#input\_resource\_group\_name\_prefix)

Description: The prefix to use for the resource group name. If not specified, the naming module will generate a unique name. Set to empty string to use only the naming module suffix.

Type: `string`

Default: `"rg-apim"`

## Outputs

The following outputs are exported:

### <a name="output_apim_gateway_url"></a> [apim\_gateway\_url](#output\_apim\_gateway\_url)

Description: The gateway URL of the API Management service.

### <a name="output_apim_identity_principal_id"></a> [apim\_identity\_principal\_id](#output\_apim\_identity\_principal\_id)

Description: The principal ID of the APIM system-assigned managed identity.

### <a name="output_apim_resource_id"></a> [apim\_resource\_id](#output\_apim\_resource\_id)

Description: The resource ID of the API Management service.

### <a name="output_named_value_ids"></a> [named\_value\_ids](#output\_named\_value\_ids)

Description: Map of named value keys to their resource IDs.

### <a name="output_named_values"></a> [named\_values](#output\_named\_values)

Description: The named values created in the API Management service.

### <a name="output_policy"></a> [policy](#output\_policy)

Description: Service-level policy details.

### <a name="output_product_ids"></a> [product\_ids](#output\_product\_ids)

Description: Map of product keys to their resource IDs.

### <a name="output_products"></a> [products](#output\_products)

Description: The products created in the API Management service.

### <a name="output_subscription_keys"></a> [subscription\_keys](#output\_subscription\_keys)

Description: Map of subscription keys to their primary and secondary keys.

### <a name="output_subscriptions"></a> [subscriptions](#output\_subscriptions)

Description: The subscriptions created in the API Management service.

## Modules

The following Modules are called:

### <a name="module_apim"></a> [apim](#module\_apim)

Source: ../../

Version:

### <a name="module_naming"></a> [naming](#module\_naming)

Source: Azure/naming/azurerm

Version: >= 0.3.0

### <a name="module_regions"></a> [regions](#module\_regions)

Source: Azure/regions/azurerm

Version: >= 0.3.0

# Footer content for the named values example
<!-- END_TF_DOCS -->